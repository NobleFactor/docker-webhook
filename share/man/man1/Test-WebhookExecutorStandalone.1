.\" SPDX-FileCopyrightText: 2016-2025 Noble Factor
.\" SPDX-License-Identifier: MIT
.TH Test-WebhookExecutorStandalone 1 "November 2025" "docker-webhook" "User Commands"
.SH NAME
Test-WebhookExecutorStandalone \- black-box test for webhook-executor binary with container provisioning
.SH SYNOPSIS
.B Test-WebhookExecutorStandalone
\fI--location\fR \fILOCATION\fR \fI--command\fR \fICOMMANDS\fR [\fI--help\fR]
.SH DESCRIPTION
Test-WebhookExecutorStandalone is a black-box test script that validates the responses
from the webhook-executor binary directly. It sources the hooks environment file for the specified location
to obtain WEBHOOK_KEYVAULT_URL and WEBHOOK_SECRET_NAME, fetches Azure service principal credentials
(client ID, tenant ID, and client secret) using the provided service principal name, fetches the JWT token
from Azure Key Vault, provisions a test Docker container with SSH access, and runs the Go binary with command
execution parameters and JWT authentication, verifying that the JSON responses conform to the expected schema.

The script automatically:
.IP "-" 2
Builds the test container image if not present
.IP "-" 2
Starts the container with the authorized SSH key
.IP "-" 2
Waits for the container and SSH user to be ready
.IP "-" 2
Constructs the SSH destination address dynamically using Docker inspection
.IP "-" 2
Sets WEBHOOK_CONFIG to the location-based configuration directory

For each command specified:
.IP "-" 2
Runs the webhook-executor binary with the constructed destination, --command, --authorization
.IP "-" 2
Validates the JSON response contains required fields: exit_code, reason, error, stdout, stderr
.IP "-" 2
Reports success or failure with detailed output

The test requires the webhook-executor binary to be available, Docker for container provisioning,
and environment variables set for Key Vault access.
See the API Reference section in README.md for complete response schema documentation.
.SH OPTIONS
.TP
.B -h,--help
Display usage information and exit.
.TP
.B --command COMMANDS
Required. A semicolon-separated list of commands to execute and test (for example: "echo 'hello world'; ls").
The script splits the string on semicolons and executes each command in-order while preserving embedded
spaces and quotes.
.TP
.B --location LOCATION
Required. The location identifier (e.g., us-wa) used to source the hooks environment file
from webhook.config/LOCATION/hooks.env and set WEBHOOK_CONFIG.
.TP
.B --location LOCATION
Required. The location identifier (e.g., us-wa). The test sources credentials and Key Vault-related variables
from the location-specific hooks.env (webhook.config/LOCATION/hooks.env). The script may also invoke
the bundled bin/New-WebhookExecutorToken to obtain or refresh a JWT token as needed.
.SH EXIT STATUS
The script exits with code 0 if all tests pass, or 1 if any test fails. Individual command
failures are reported but do not immediately terminate the script; all specified commands
are tested.
.SH EXAMPLES
Test a single semicolon-separated command string:
.IP
Test-WebhookExecutorStandalone --location us-wa --command "uptime"

Test multiple commands (semicolon-separated):
.IP
Test-WebhookExecutorStandalone --location us-wa --command "echo 'hello world'; date; whoami"
.SH SEE ALSO
.BR README.md (API Reference),
.BR docker-webhook (1),
.BR webhook-executor (1),
.BR Test-WebhookExecutorIntegration (1)
.SH AUTHOR
David Noble
.SH COPYRIGHT
Copyright \(co 2016-2025 Noble Factor.
.br
Licensed under the MIT License.